<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Investia â€” Assistant IA</title>
    <style>
        :root{
            --bg:#f6f8fc;--card:#fff;--text:#0f172a;--muted:#64748b;
            --border:rgba(15,23,42,.10);--shadow:0 14px 35px rgba(15,23,42,.08);
            --primary:#1d4ed8;--accent:#06b6d4;--success:#16a34a;
            --danger:#ef4444;--navy:#0b2a55;--warning:#d97706;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
            background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column}

        /* â•â• NAVBAR â•â• */
        .navbar{position:sticky;top:0;z-index:200;background:#fff;
            border-bottom:1px solid rgba(15,23,42,.08);box-shadow:0 4px 16px rgba(15,23,42,.06);flex-shrink:0}
        .nav-inner{max-width:900px;margin:0 auto;padding:0 16px;height:52px;display:flex;align-items:center}
        .nav-brand{font-size:17px;font-weight:900;color:var(--navy);margin-right:32px}
        .nav-brand span{color:var(--warning)}
        .nav-links{display:flex;gap:4px}
        .nav-link{padding:6px 14px;border-radius:8px;font-size:13.5px;font-weight:700;
            color:var(--muted);cursor:pointer;border:none;background:none;transition:all .15s}
        .nav-link:hover{color:var(--primary);background:rgba(29,78,216,.06)}
        .nav-link.active{color:var(--primary);background:rgba(29,78,216,.08)}

        /* â•â• LAYOUT â•â• */
        .chat-wrapper{flex:1;max-width:900px;width:100%;margin:0 auto;
            padding:20px 16px 0;display:flex;flex-direction:column;overflow:hidden}

        /* â•â• HERO â•â• */
        .chat-hero{background:linear-gradient(135deg,var(--navy),#1d4ed8);
            border-radius:18px;padding:20px 24px;margin-bottom:16px;
            display:flex;align-items:center;gap:16px;flex-shrink:0}
        .hero-avatar{width:52px;height:52px;border-radius:14px;
            background:rgba(255,255,255,.15);display:grid;
            place-items:center;font-size:26px;flex-shrink:0}
        .hero-text h2{color:#fff;font-size:18px;font-weight:900;margin-bottom:4px}
        .hero-text p{color:rgba(255,255,255,.70);font-size:13px;line-height:1.5}
        .hero-status{margin-left:auto;display:flex;align-items:center;gap:7px;
            font-size:12px;font-weight:800;color:rgba(255,255,255,.80);flex-shrink:0}
        .status-dot{width:8px;height:8px;border-radius:50%;background:#4ade80;
            box-shadow:0 0 0 3px rgba(74,222,128,.3);animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

        /* â•â• SUGGESTIONS â•â• */
        .suggestions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;flex-shrink:0}
        .sug-btn{padding:7px 13px;border-radius:999px;border:1px solid rgba(29,78,216,.25);
            background:rgba(29,78,216,.06);color:var(--primary);font-size:12px;
            font-weight:700;cursor:pointer;transition:all .15s;white-space:nowrap}
        .sug-btn:hover{background:rgba(29,78,216,.12);border-color:rgba(29,78,216,.4)}

        /* â•â• MESSAGES â•â• */
        .messages{flex:1;overflow-y:auto;display:flex;flex-direction:column;
            gap:14px;padding:4px 2px 16px;scroll-behavior:smooth}
        .messages::-webkit-scrollbar{width:5px}
        .messages::-webkit-scrollbar-thumb{background:var(--border);border-radius:999px}

        /* Message row */
        .msg-row{display:flex;align-items:flex-end;gap:10px}
        .msg-row.user{flex-direction:row-reverse}

        .msg-avatar{width:34px;height:34px;border-radius:10px;display:grid;
            place-items:center;font-size:16px;flex-shrink:0}
        .msg-avatar.bot {background:linear-gradient(135deg,var(--primary),var(--accent))}
        .msg-avatar.user{background:linear-gradient(135deg,var(--success),#059669)}

        .msg-bubble{max-width:72%;padding:12px 16px;border-radius:16px;
            font-size:14px;line-height:1.65;word-break:break-word}
        .msg-row.bot  .msg-bubble{background:#fff;border:1px solid var(--border);
            border-bottom-left-radius:4px;
            box-shadow:0 4px 14px rgba(15,23,42,.06)}
        .msg-row.user .msg-bubble{background:linear-gradient(135deg,var(--primary),var(--accent));
            color:#fff;border-bottom-right-radius:4px;
            box-shadow:0 4px 14px rgba(29,78,216,.22)}
        .msg-time{font-size:10.5px;color:var(--muted);margin-top:4px;
            display:block;text-align:right}
        .msg-row.bot .msg-time{text-align:left}

        /* Typing indicator */
        .typing-row{display:flex;align-items:flex-end;gap:10px}
        .typing-bubble{background:#fff;border:1px solid var(--border);border-radius:16px;
            border-bottom-left-radius:4px;padding:14px 18px;
            display:flex;gap:5px;align-items:center}
        .dot{width:7px;height:7px;border-radius:50%;background:var(--primary);
            animation:bounce .9s ease-in-out infinite}
        .dot:nth-child(2){animation-delay:.15s}
        .dot:nth-child(3){animation-delay:.30s}
        @keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-7px)}}

        /* â•â• INPUT â•â• */
        .input-area{background:#fff;border-top:1px solid var(--border);
            padding:14px 16px;flex-shrink:0}
        .input-inner{max-width:900px;margin:0 auto;display:flex;gap:10px;align-items:flex-end}
        .input-wrap{flex:1;position:relative}
        #userInput{width:100%;padding:12px 16px;border:1.5px solid var(--border);
            border-radius:14px;font-size:14px;font-family:inherit;
            outline:none;resize:none;min-height:46px;max-height:120px;
            line-height:1.5;transition:border-color .15s,box-shadow .15s;
            color:var(--text);background:#fff}
        #userInput:focus{border-color:rgba(29,78,216,.4);
            box-shadow:0 0 0 3px rgba(29,78,216,.10)}
        #userInput::placeholder{color:#94a3b8}
        .send-btn{width:46px;height:46px;border-radius:12px;border:none;cursor:pointer;
            background:linear-gradient(135deg,var(--primary),var(--accent));
            color:#fff;font-size:18px;display:grid;place-items:center;
            flex-shrink:0;transition:filter .15s,transform .1s;
            box-shadow:0 6px 16px rgba(29,78,216,.25)}
        .send-btn:hover{filter:brightness(1.08)}
        .send-btn:active{transform:scale(.95)}
        .send-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
        .input-hint{font-size:11px;color:#94a3b8;margin-top:5px;text-align:center}
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="nav-inner">
        <div class="nav-brand">ğŸ“… Invest<span>ia</span></div>
        <div class="nav-links">
            <button class="nav-link" onclick="goPage('ev')">ğŸ“‹ Ã‰vÃ©nements</button>
            <button class="nav-link" onclick="goPage('inv')">âœ‰ï¸ Invitations</button>
            <button class="nav-link active">ğŸ¤– Assistant IA</button>
        </div>
    </div>
</nav>

<div class="chat-wrapper">

    <!-- HERO -->
    <div class="chat-hero">
        <div class="hero-avatar">ğŸ¤–</div>
        <div class="hero-text">
            <h2>Alex â€” Assistant Investia</h2>
            <p>Je rÃ©ponds Ã  toutes vos questions sur les Ã©vÃ©nements et invitations en temps rÃ©el.</p>
        </div>
        <div class="hero-status">
            <span class="status-dot"></span>
            En ligne
        </div>
    </div>

    <!-- SUGGESTIONS -->
    <div class="suggestions">
        <button class="sug-btn" onclick="askSuggestion(this)">ğŸ“‹ Combien d'Ã©vÃ©nements ?</button>
        <button class="sug-btn" onclick="askSuggestion(this)">ğŸ‘¥ Total des invitÃ©s ?</button>
        <button class="sug-btn" onclick="askSuggestion(this)">ğŸŒ Ã‰vÃ©nements en ligne ?</button>
        <button class="sug-btn" onclick="askSuggestion(this)">ğŸ¢ Ã‰vÃ©nements prÃ©sentiel ?</button>
        <button class="sug-btn" onclick="askSuggestion(this)">ğŸ“… Prochain Ã©vÃ©nement ?</button>
    </div>

    <!-- MESSAGES -->
    <div class="messages" id="messages">
        <!-- Message de bienvenue -->
        <div class="msg-row bot">
            <div class="msg-avatar bot">ğŸ¤–</div>
            <div>
                <div class="msg-bubble">
                    Bonjour ! Je suis <strong>Alex</strong>, votre assistant Investia. ğŸ‘‹<br/><br/>
                    Je peux rÃ©pondre Ã  toutes vos questions sur les <strong>Ã©vÃ©nements</strong>
                    et les <strong>invitations</strong>. Comment puis-je vous aider ?
                </div>
                <span class="msg-time" id="welcomeTime"></span>
            </div>
        </div>
    </div>

    <!-- INPUT -->
    <div class="input-area">
        <div class="input-inner">
            <div class="input-wrap">
        <textarea id="userInput" placeholder="Posez votre questionâ€¦" rows="1"
                  onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
            </div>
            <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Envoyer">â¤</button>
        </div>
        <p class="input-hint">Appuyez sur EntrÃ©e pour envoyer â€¢ Maj+EntrÃ©e pour aller Ã  la ligne</p>
    </div>

</div>

<script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  Ã‰TAT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var isWaiting = false;

    // Afficher l'heure du message de bienvenue
    document.getElementById('welcomeTime').textContent = now();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ENVOYER UN MESSAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function sendMessage() {
        var input = document.getElementById('userInput');
        var text  = input.value.trim();
        if (!text || isWaiting) return;

        // Afficher le message utilisateur
        appendMessage('user', text);
        input.value = '';
        autoResize(input);

        // Afficher "typing..."
        showTyping();
        isWaiting = true;
        document.getElementById('sendBtn').disabled = true;

        // Appel Java
        if (window.chatBridge && typeof window.chatBridge.ask === 'function') {
            window.chatBridge.ask(text);
        } else {
            receiveAnswer('Bridge indisponible â€” relancez l\'application.');
        }
    }

    // Suggestion rapide
    function askSuggestion(btn) {
        var text = btn.textContent.replace(/^[^\s]+\s/, '').trim(); // retire l'emoji
        document.getElementById('userInput').value = btn.textContent;
        sendMessage();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  RECEVOIR LA RÃ‰PONSE DE JAVA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function receiveAnswer(text) {
        hideTyping();
        isWaiting = false;
        document.getElementById('sendBtn').disabled = false;
        appendMessage('bot', text);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  AFFICHER UN MESSAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function appendMessage(role, text) {
        var messages = document.getElementById('messages');
        var isUser   = role === 'user';

        var row = document.createElement('div');
        row.className = 'msg-row ' + role;

        var avatar = document.createElement('div');
        avatar.className = 'msg-avatar ' + role;
        avatar.textContent = isUser ? 'ğŸ‘¤' : 'ğŸ¤–';

        var wrapper = document.createElement('div');

        var bubble = document.createElement('div');
        bubble.className = 'msg-bubble';
        // Convertir les **bold** en <strong>
        bubble.innerHTML = formatText(text);

        var time = document.createElement('span');
        time.className = 'msg-time';
        time.textContent = now();

        wrapper.appendChild(bubble);
        wrapper.appendChild(time);

        if (isUser) {
            row.appendChild(wrapper);
            row.appendChild(avatar);
        } else {
            row.appendChild(avatar);
            row.appendChild(wrapper);
        }

        messages.appendChild(row);
        messages.scrollTop = messages.scrollHeight;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  TYPING INDICATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showTyping() {
        var messages = document.getElementById('messages');
        var row = document.createElement('div');
        row.className = 'typing-row';
        row.id = 'typingRow';
        row.innerHTML =
            '<div class="msg-avatar bot">ğŸ¤–</div>'
            +'<div class="typing-bubble">'
            +'<div class="dot"></div><div class="dot"></div><div class="dot"></div>'
            +'</div>';
        messages.appendChild(row);
        messages.scrollTop = messages.scrollHeight;
    }

    function hideTyping() {
        var el = document.getElementById('typingRow');
        if (el) el.remove();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  UTILS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function handleKey(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    }

    function autoResize(el) {
        el.style.height = 'auto';
        el.style.height = Math.min(el.scrollHeight, 120) + 'px';
    }

    function formatText(text) {
        // **bold** â†’ <strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        // Nouvelles lignes
        text = text.replace(/\n/g, '<br/>');
        // â€¢ listes
        text = text.replace(/^â€¢ /gm, '&bull; ');
        return text;
    }

    function now() {
        var d = new Date();
        return d.getHours().toString().padStart(2,'0') + ':'
            + d.getMinutes().toString().padStart(2,'0');
    }

    function goPage(page) {
        if (!window.chatBridge) return;
        if (page === 'ev')  window.chatBridge.goEvenements();
        if (page === 'inv') window.chatBridge.goInvitations();
    }
</script>
</body>
</html>